@*
For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model ContractHome.Models.Dto.DigitalSignModal
@{

}

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>安心簽 UX SIGN 數位簽章管理系統</title>
  <!-- MDB icon -->
  <link rel="icon" href="~/images/uxSign.ico" type="image/x-icon" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="~/css/fontawesome/all.css" />
  <!-- Google Fonts Roboto -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900">
  <!-- Boostrap -->
  <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
  <!-- 網站設定樣式 -->
  <link rel="stylesheet" href="~/css/site.css" />
  <script type="text/javascript" src="~/lib/jquery/dist/jquery.js"></script>
  <script type="text/javascript" src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  @{
    await Html.RenderPartialAsync("~/Views/Shared/CommonScriptInclude.cshtml");
  }
</head>

<body>
  <input id="contractID" value="@(Model.ContractID)" type="hidden">
  <input id="contractNo" value="@(Model.ContractNo)" type="hidden">
  <input id="contractTitle" value="@(Model.ContractTitle)" type="hidden">
  <div class="container mt-5">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title fw-bolder" id="staticBackdropLabel">簽署文件</h5>
        <div class="card-text">
          <div class="card d-flex flex-row align-items-center justify-content-center p-3 mb-4">
            <div class="text-center fs-1 cornflowerBlue pe-3">
              <i class="fad fa-file-signature fa-lg"></i>
            </div>
            <div>
              <div class="h6 fw-bolder">
                文件編號： @Model.ContractNo
              </div>
              <div class="h6 fw-bolder">
                文件名稱： @Model.ContractTitle
              </div>
            </div>
          </div>
          <div class="text-center h5 fw-bolder">
            您將代表 <span class="text-primary opacity-75">" @Model.CompanyName "</span> 對此文件進行數位簽署
          </div>
          <div class="pt-3 text-center">
            <span>如同意簽署，則您的個人資訊紕露亦遵循 服務條款 及 隱私權政策 的規範。</span>
            <div class="d-flex align-items-center justify-content-center pt-2 fs-6 fw-bold">
              <input class="form-check-input mt-0 me-2" type="checkbox" id="agree">
              <label class="form-check-label text-primary" for="agree">
                我已閱讀並同意遵守 <a class="link" href="@Url.Action("Personal", "Home")">個資保護</a> 及 <a class="link" href="@Url.Action("Privacy", "Home")">隱私政策</a>
              </label>
            </div>
          </div>
          <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
            <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" />
            </symbol>
          </svg>
          <div class="alert alert-danger d-flex align-items-center justify-content-center mt-4" role="alert">
            <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:">
              <use xlink:href="#info-fill" />
            </svg>
            <div class="fs-14 fw-bolder">
              簽章成功後，本文件即具有正式法律效力。
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-center">
          <button type="button" class="btn btn-secondary opacity-75 mx-1" id="backToSomewhere">取消</button>
          <button type="button" class="btn btn-primary mx-1 disabled" id="confirmSign">確定</button>
        </div>
      </div>
    </div>
  </div>
</body>
<script>
  $(function () {
    $("#backToSomewhere").on("click", function () {
      window.location.href = '@(Url.Action("Logout", "Account"))';
    });

    $('#agree').on('change', function (event) {
      event.preventDefault();
      let isChecked = event.target.checked;
      if (isChecked) {
        $('#confirmSign').removeClass('disabled');
      } else {
        $('#confirmSign').addClass('disabled');
      }
    });

    $("#confirmSign").on("click", function () {
      showLoading();
      $.post('@Html.Raw(Url.Action("CommitDigitalSignature", "ContractConsole"))', {
        'KeyID': $("#contractID").val(),
        'Signature': null
      }, function (data) {
        hideLoading();
        if (data.result) {
          alertModal(`${$("#contractTitle").val()}<br>(${$("#contractNo").val()}) <br>簽署完成！`);
          setTimeout(() => {
            window.location.href = '@(Url.Action("ListToStampIndex", "ContractConsole"))';
          }, 3000);
        } else {
          alertModal(data.message);
        }
      });
    });
  });
</script>