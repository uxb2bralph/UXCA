@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model ContractHome.Models.Dto.DigitalSignModal
@{

}


<head>
    <title>DigitalSignModal</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body>
    <input id="contractID" value="@(Model.ContractID)" type="hidden">
    <div class="container">
        <!-- Modal -->
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Modal Header</h4>
                    </div>
                    <div class="modal-body">
                        <div class="card d-flex flex-row align-items-center justify-content-center p-3 mb-4">
                            <div class="text-center fs-1 cornflowerBlue pe-3">
                                <i class="fad fa-file-signature fa-lg"></i>
                            </div>
                            <div>
                                <div class="h6 fw-bolder">
                                    文件編號： @Model.ContractNo
                                </div>
                                <div class="h6 fw-bolder">
                                    專案名稱： @Model.ContractTitle
                                </div>
                            </div>
                        </div>
                        <div class="text-center h5 fw-bolder">
                            您將代表 <span class="text-primary opacity-75">" @Model.CompanyName "</span> 對此文件進行數位簽章
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                            <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" />
                            </symbol>
                        </svg>
                        <div class="alert alert-danger d-flex align-items-center mt-4" role="alert">
                            <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:">
                                <use xlink:href="#info-fill" />
                            </svg>
                            <div class="fs-14 fw-bolder">
                                簽章成功後，本文件即具有正式法律效力。
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-top-0 justify-content-center">
                        <button type="button" class="btn btn-secondary opacity-50" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" id="confirmSign">確定</button>
                    </div>
                </div>
            </div>
        </div>
    </div>



</body>
<script>
    $('#myModal').modal({
        show: 'true'
    });

    $("#confirmSign").on("click", function () {
        $.post('@Html.Raw(Url.Action("CommitDigitalSignature", "ContractConsole"))', {
            'KeyID': $("#contractID").val(),
            'Signature': null
        }, function (data) {
            if (data.result) {
                alert('簽章完成!!');
                setTimeout(() => {
                    window.location.href = '@(Url.Action("ListToStampIndex", "ContractConsole"))';
                }, 3000);
            } else {
                alert(data.message);
            }
        });
    });

</script>